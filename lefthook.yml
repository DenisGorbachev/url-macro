assert_lefthook_installed: true
pre-commit:
  parallel: true
  commands:
    gen:readme:
      run: |
        set -eu
        mise run gen:readme
        # README.md may not be created if `mise run gen:readme` is a stub
        if [ -f README.md ]; then
          # run rumdl because README.md has changed
          rumdl fmt README.md
          # add README.md manually instead of using `stage_fixed` because it may not have been staged
          git add README.md
        fi
    fmt:
      run: mise run fmt
      stage_fixed: true
      # `files` is needed for `stage_fixed` (by default, `stage_fixed` uses `{staged_files}`, but fmt may modify files which haven't been staged)
      files: git diff --name-only HEAD
    fixlint:
      run: mise run fixlint
      stage_fixed: true
    test:
      run: mise run test
    sort:deps:
      run: mise run sort:deps
      stage_fixed: true
commit-msg:
  commands:
    commitlint:
      run: mise run commitlint -- --edit "$1"
